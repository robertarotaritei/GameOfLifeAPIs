ö3
FD:\School\GameOfLifeAPIs\UserAPI\UserAPI\Controllers\UserController.cs
	namespace 	
UserAPI
 
. 
Controllers 
{ 
[ 
ApiController 
] 
[		 
Route		 

(		
 
$str		 %
)		% &
]		& '
public

 

class

 
UserController

 
{ 
public 

IUserQuery 

_userQuery $
{% &
get' *
;* +
}, -
public 
UserController 
( 

IUserQuery (
	userQuery) 2
)2 3
{ 	

_userQuery 
= 
	userQuery "
;" #
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
async 
Task 
< 
IActionResult '
>' (
GetOne) /
(/ 0
int0 3
id4 6
)6 7
{ 	
var 
result 
= 
await 

_userQuery )
.) *
FindOneAsync* 6
(6 7
id7 9
)9 :
;: ;
if 
( 
result 
is 
null 
) 
return 
new 
NotFoundResult )
() *
)* +
;+ ,
return 
new 
OkObjectResult %
(% &
result& ,
), -
;- .
} 	
[   	
HttpGet  	 
]   
[!! 	
Route!!	 
(!! 
$str!! 
)!! 
]!! 
public"" 
async"" 
Task"" 
<"" 
IActionResult"" '
>""' (
	VerifyOne"") 2
(""2 3
string""3 9
username"": B
,""B C
string""D J
password""K S
)""S T
{## 	
var$$ 
result$$ 
=$$ 
await$$ 

_userQuery$$ )
.$$) *
VerifyOneAsync$$* 8
($$8 9
username$$9 A
,$$A B
password$$C K
)$$K L
;$$L M
if&& 
(&& 
result&& 
is&& 
null&& 
)&& 
return'' 
new'' 
NotFoundResult'' )
('') *
)''* +
;''+ ,
return)) 
new)) 
OkObjectResult)) %
())% &
result))& ,
))), -
;))- .
}** 	
[-- 	
HttpGet--	 
]-- 
[.. 	
Route..	 
(.. 
$str.. 
)..  
]..  !
public// 
async// 
Task// 
<// 
IActionResult// '
>//' (
VerifyUsername//) 7
(//7 8
string//8 >
username//? G
)//G H
{00 	
var11 
result11 
=11 
await11 

_userQuery11 )
.11) *
VerifyUsernameAsync11* =
(11= >
username11> F
)11F G
;11G H
if33 
(33 
result33 
is33 
null33 
)33 
return44 
new44 
NotFoundResult44 )
(44) *
)44* +
;44+ ,
return66 
new66 
OkObjectResult66 %
(66% &
result66& ,
)66, -
;66- .
}77 	
[:: 	
HttpPost::	 
]:: 
public;; 
async;; 
Task;; 
<;; 
IActionResult;; '
>;;' (
Post;;) -
(;;- .
[;;. /
FromBody;;/ 7
];;7 8
User;;9 =
body;;> B
);;B C
{<< 	
if== 
(== 
body== 
.== 
Username== 
.== 
Length== $
>==% &
$num==' (
&&==) +
body==, 0
.==0 1
Password==1 9
.==9 :
Length==: @
>==A B
$num==C D
)==D E
{>> 
await?? 

_userQuery??  
.??  !
InsertAsync??! ,
(??, -
body??- 1
)??1 2
;??2 3
returnAA 
newAA 
OkObjectResultAA )
(AA) *
bodyAA* .
)AA. /
;AA/ 0
}BB 
returnDD 
newDD 
NotFoundResultDD %
(DD% &
)DD& '
;DD' (
}EE 	
[HH 	
HttpPutHH	 
(HH 
$strHH 
)HH 
]HH 
publicII 
asyncII 
TaskII 
<II 
IActionResultII '
>II' (
PutOneII) /
(II/ 0
intII0 3
idII4 6
,II6 7
[II8 9
FromBodyII9 A
]IIA B
stringIIC I
passwordIIJ R
)IIR S
{JJ 	
varKK 
resultKK 
=KK 
awaitKK 

_userQueryKK )
.KK) *
UpdateAsyncKK* 5
(KK5 6
idKK6 8
,KK8 9
passwordKK: B
)KKB C
;KKC D
ifMM 
(MM 
resultMM 
isMM 
nullMM 
)MM 
returnNN 
newNN 
NotFoundResultNN )
(NN) *
)NN* +
;NN+ ,
returnPP 
newPP 
OkObjectResultPP %
(PP% &
resultPP& ,
)PP, -
;PP- .
}QQ 	
[TT 	

HttpDeleteTT	 
(TT 
$strTT 
)TT 
]TT 
publicUU 
asyncUU 
TaskUU 
<UU 
IActionResultUU '
>UU' (
	DeleteOneUU) 2
(UU2 3
intUU3 6
idUU7 9
)UU9 :
{VV 	
varWW 
resultWW 
=WW 
awaitWW 

_userQueryWW )
.WW) *
DeleteAsyncWW* 5
(WW5 6
idWW6 8
)WW8 9
;WW9 :
ifYY 
(YY 
resultYY 
isYY 
nullYY 
)YY 
returnZZ 
newZZ 
NotFoundResultZZ )
(ZZ) *
)ZZ* +
;ZZ+ ,
return\\ 
new\\ 
OkObjectResult\\ %
(\\% &
result\\& ,
)\\, -
;\\- .
}]] 	
}^^ 
}__ ≤
@D:\School\GameOfLifeAPIs\UserAPI\UserAPI\Infrastructure\AppDb.cs
	namespace 	
UserAPI
 
{ 
public 

sealed 
class 
AppDb 
: 
IDisposable  +
{ 
public 
MySqlConnection 

Connection )
{* +
get, /
;/ 0
}1 2
public

 
AppDb

 
(

 
string

 
connectionString

 ,
)

, -
{ 	

Connection 
= 
new 
MySqlConnection ,
(, -
connectionString- =
)= >
;> ?
} 	
public 
void 
Dispose 
( 
) 
{ 	

Connection 
. 
Dispose 
( 
)  
;  !
GC 
. 
SuppressFinalize 
(  
this  $
)$ %
;% &
} 	
} 
} †
ED:\School\GameOfLifeAPIs\UserAPI\UserAPI\Infrastructure\IUserQuery.cs
	namespace 	
UserAPI
 
. 
Infrastructure  
{ 
public 

	interface 

IUserQuery 
{ 
Task 
< 
User 
> 
InsertAsync 
( 
User #
body$ (
)( )
;) *
Task

 
<

 
User

 
>

 
UpdateAsync

 
(

 
int

 "
id

# %
,

% &
string

' -
password

. 6
)

6 7
;

7 8
Task 
< 
User 
> 
DeleteAsync 
( 
int "
id# %
)% &
;& '
Task 
< 
User 
> 
FindOneAsync 
(  
int  #
id$ &
)& '
;' (
Task 
< 
User 
> 
VerifyOneAsync !
(! "
string" (
username) 1
,1 2
string3 9
password: B
)B C
;C D
Task 
< 
User 
> 
VerifyUsernameAsync &
(& '
string' -
username. 6
)6 7
;7 8
} 
} …
GD:\School\GameOfLifeAPIs\UserAPI\UserAPI\Infrastructure\SqlStatement.cs
	namespace 	
UserAPI
 
. 
Infrastructure  
{ 
public 

class 
SqlStatement 
{ 
public 
string 
InsertAsync !
{" #
get$ '
;' (
}) *
public 
string 
UpdateAsync !
{" #
get$ '
;' (
}) *
public		 
string		 
DeleteAsync		 !
{		" #
get		$ '
;		' (
}		) *
public 
string 
FindOneAsync "
{# $
get% (
;( )
}* +
public 
string 
VerifyOneAsync $
{% &
get' *
;* +
}- .
public 
string 
VerifyUsernameAsync )
{* +
get, /
;/ 0
}1 2
public 
SqlStatement 
( 
) 
{ 	
InsertAsync 
= 
$str h
;h i
UpdateAsync 
= 
$str W
;W X
DeleteAsync 
= 
$str A
;A B
FindOneAsync 
= 
$str C
;C D
VerifyOneAsync 
= 
$str m
;m n
VerifyUsernameAsync 
=  !
$str" X
;X Y
} 	
} 
} Âm
DD:\School\GameOfLifeAPIs\UserAPI\UserAPI\Infrastructure\UserQuery.cs
	namespace 	
UserAPI
 
. 
Models 
{		 
public

 

class

 
	UserQuery

 
:

 

IUserQuery

 '
{ 
public 
AppDb 
Db 
{ 
get 
; 
}  
public 
SqlStatement 
	Statement %
{& '
get( +
;+ ,
}- .
public 
	UserQuery 
( 
string 
connectionString  0
)0 1
{ 	
Db 
= 
new 
AppDb 
( 
connectionString +
)+ ,
;, -
	Statement 
= 
new 
SqlStatement (
(( )
)) *
;* +
} 	
public 
async 
Task 
< 
User 
> 
InsertAsync  +
(+ ,
User, 0
body1 5
)5 6
{ 	
await 
Db 
. 

Connection #
.# $
	OpenAsync$ -
(- .
). /
;/ 0
using 
var 
cmd 
= 
Db  "
." #

Connection# -
.- .
CreateCommand. ;
(; <
)< =
;= >
cmd 
. 
CommandText 
=  !
	Statement" +
.+ ,
InsertAsync, 7
;7 8

BindParams 
( 
cmd 
, 
body  $
.$ %
Username% -
,- .
body/ 3
.3 4
Password4 <
)< =
;= >
await 
cmd 
.  
ExecuteNonQueryAsync .
(. /
)/ 0
;0 1
body 
. 
Id 
= 
( 
int 
) 
cmd "
." #
LastInsertedId# 1
;1 2
return 
body 
; 
}   	
public"" 
async"" 
Task"" 
<"" 
User"" 
>"" 
UpdateAsync""  +
(""+ ,
int"", /
id""0 2
,""2 3
string""4 :
password""; C
)""C D
{## 	
await$$ 
Db$$ 
.$$ 

Connection$$ 
.$$  
	OpenAsync$$  )
($$) *
)$$* +
;$$+ ,
using%% 
var%% 
cmd%% 
=%% 
Db%% 
.%% 

Connection%% )
.%%) *
CreateCommand%%* 7
(%%7 8
)%%8 9
;%%9 :
cmd&& 
.&& 
CommandText&& 
=&& 
	Statement&& '
.&&' (
UpdateAsync&&( 3
;&&3 4
BindPassword'' 
('' 
cmd'' 
,'' 
password'' &
)''& '
;''' (
BindId(( 
((( 
cmd(( 
,(( 
id(( 
)(( 
;(( 
var)) 
result)) 
=)) 
await)) 
ReadAllAsync)) +
())+ ,
await)), 1
cmd))2 5
.))5 6
ExecuteReaderAsync))6 H
())H I
)))I J
)))J K
;))K L
return++ 
result++ 
.++ 
Count++ 
>++  !
$num++" #
?++$ %
result++& ,
[++, -
$num++- .
]++. /
:++0 1
null++2 6
;++6 7
},, 	
public.. 
async.. 
Task.. 
<.. 
User.. 
>.. 
DeleteAsync..  +
(..+ ,
int.., /
id..0 2
)..2 3
{// 	
var00 
body00 
=00 
await00 
FindOneAsync00 )
(00) *
id00* ,
)00, -
;00- .
using11 
var11 
cmd11 
=11 
Db11 
.11 

Connection11 )
.11) *
CreateCommand11* 7
(117 8
)118 9
;119 :
cmd22 
.22 
CommandText22 
=22 
	Statement22 '
.22' (
DeleteAsync22( 3
;223 4
BindId33 
(33 
cmd33 
,33 
id33 
)33 
;33 
await44 
cmd44 
.44  
ExecuteNonQueryAsync44 *
(44* +
)44+ ,
;44, -
return66 
body66 
;66 
}77 	
public99 
async99 
Task99 
<99 
User99 
>99 
FindOneAsync99  ,
(99, -
int99- 0
id991 3
)993 4
{:: 	
await;; 
Db;; 
.;; 

Connection;; 
.;;  
	OpenAsync;;  )
(;;) *
);;* +
;;;+ ,
using<< 
var<< 
cmd<< 
=<< 
Db<< 
.<< 

Connection<< )
.<<) *
CreateCommand<<* 7
(<<7 8
)<<8 9
;<<9 :
cmd== 
.== 
CommandText== 
=== 
	Statement== '
.==' (
FindOneAsync==( 4
;==4 5
BindId>> 
(>> 
cmd>> 
,>> 
id>> 
)>> 
;>> 
var?? 
result?? 
=?? 
await?? 
ReadAllAsync?? +
(??+ ,
await??, 1
cmd??2 5
.??5 6
ExecuteReaderAsync??6 H
(??H I
)??I J
)??J K
;??K L
returnAA 
resultAA 
.AA 
CountAA 
>AA  !
$numAA" #
?AA$ %
resultAA& ,
[AA, -
$numAA- .
]AA. /
:AA0 1
nullAA2 6
;AA6 7
}BB 	
publicDD 
asyncDD 
TaskDD 
<DD 
UserDD 
>DD 
VerifyOneAsyncDD  .
(DD. /
stringDD/ 5
usernameDD6 >
,DD> ?
stringDD@ F
passwordDDG O
)DDO P
{EE 	
awaitFF 
DbFF 
.FF 

ConnectionFF 
.FF  
	OpenAsyncFF  )
(FF) *
)FF* +
;FF+ ,
usingGG 
varGG 
cmdGG 
=GG 
DbGG 
.GG 

ConnectionGG )
.GG) *
CreateCommandGG* 7
(GG7 8
)GG8 9
;GG9 :
cmdHH 
.HH 
CommandTextHH 
=HH 
	StatementHH '
.HH' (
VerifyOneAsyncHH( 6
;HH6 7

BindParamsII 
(II 
cmdII 
,II 
usernameII $
,II$ %
passwordII& .
)II. /
;II/ 0
varJJ 
resultJJ 
=JJ 
awaitJJ 
ReadAllAsyncJJ +
(JJ+ ,
awaitJJ, 1
cmdJJ2 5
.JJ5 6
ExecuteReaderAsyncJJ6 H
(JJH I
)JJI J
)JJJ K
;JJK L
returnLL 
resultLL 
.LL 
CountLL 
>LL  !
$numLL" #
?LL$ %
resultLL& ,
[LL, -
$numLL- .
]LL. /
:LL0 1
nullLL2 6
;LL6 7
}MM 	
publicOO 
asyncOO 
TaskOO 
<OO 
UserOO 
>OO 
VerifyUsernameAsyncOO  3
(OO3 4
stringOO4 :
usernameOO; C
)OOC D
{PP 	
awaitQQ 
DbQQ 
.QQ 

ConnectionQQ 
.QQ  
	OpenAsyncQQ  )
(QQ) *
)QQ* +
;QQ+ ,
usingRR 
varRR 
cmdRR 
=RR 
DbRR 
.RR 

ConnectionRR )
.RR) *
CreateCommandRR* 7
(RR7 8
)RR8 9
;RR9 :
cmdSS 
.SS 
CommandTextSS 
=SS 
	StatementSS '
.SS' (
VerifyUsernameAsyncSS( ;
;SS; <
BindUsernameTT 
(TT 
cmdTT 
,TT 
usernameTT &
)TT& '
;TT' (
varUU 
resultUU 
=UU 
awaitUU 
ReadAllAsyncUU +
(UU+ ,
awaitUU, 1
cmdUU2 5
.UU5 6
ExecuteReaderAsyncUU6 H
(UUH I
)UUI J
)UUJ K
;UUK L
returnWW 
resultWW 
.WW 
CountWW 
>WW  !
$numWW" #
?WW$ %
resultWW& ,
[WW, -
$numWW- .
]WW. /
:WW0 1
nullWW2 6
;WW6 7
}XX 	
privateZZ 
asyncZZ 
TaskZZ 
<ZZ 
ListZZ 
<ZZ  
UserZZ  $
>ZZ$ %
>ZZ% &
ReadAllAsyncZZ' 3
(ZZ3 4
DbDataReaderZZ4 @
readerZZA G
)ZZG H
{[[ 	
var\\ 
users\\ 
=\\ 
new\\ 
List\\  
<\\  !
User\\! %
>\\% &
(\\& '
)\\' (
;\\( )
using]] 
(]] 
reader]] 
)]] 
{^^ 
while__ 
(__ 
await__ 
reader__ #
.__# $
	ReadAsync__$ -
(__- .
)__. /
)__/ 0
{`` 
varaa 
useraa 
=aa 
newaa "
Useraa# '
(aa' (
)aa( )
{bb 
Idcc 
=cc 
readercc #
.cc# $
GetInt32cc$ ,
(cc, -
$numcc- .
)cc. /
,cc/ 0
Usernamedd  
=dd! "
readerdd# )
.dd) *
	GetStringdd* 3
(dd3 4
$numdd4 5
)dd5 6
,dd6 7
Passwordee  
=ee! "
readeree# )
.ee) *
	GetStringee* 3
(ee3 4
$numee4 5
)ee5 6
,ee6 7
}ff 
;ff 
usersgg 
.gg 
Addgg 
(gg 
usergg "
)gg" #
;gg# $
}hh 
}ii 
returnkk 
userskk 
;kk 
}ll 	
privatenn 
voidnn 
BindIdnn 
(nn 
MySqlCommandnn (
cmdnn) ,
,nn, -
intnn. 1
idnn2 4
)nn4 5
{oo 	
cmdpp 
.pp 

Parameterspp 
.pp 
Addpp 
(pp 
newpp "
MySqlParameterpp# 1
{qq 
ParameterNamerr 
=rr 
$strrr  %
,rr% &
DbTypess 
=ss 
DbTypess 
.ss  
Int32ss  %
,ss% &
Valuett 
=tt 
idtt 
,tt 
}uu 
)uu 
;uu 
}vv 	
privatexx 
voidxx 

BindParamsxx 
(xx  
MySqlCommandxx  ,
cmdxx- 0
,xx0 1
stringxx2 8
usernamexx9 A
,xxA B
stringxxC I
passwordxxJ R
)xxR S
{yy 	
cmdzz 
.zz 

Parameterszz 
.zz 
Addzz 
(zz 
newzz "
MySqlParameterzz# 1
{{{ 
ParameterName|| 
=|| 
$str||  +
,||+ ,
DbType}} 
=}} 
DbType}} 
.}}  
String}}  &
,}}& '
Value~~ 
=~~ 
username~~  
,~~  !
} 
) 
; 
cmd
ÄÄ 
.
ÄÄ 

Parameters
ÄÄ 
.
ÄÄ 
Add
ÄÄ 
(
ÄÄ 
new
ÄÄ "
MySqlParameter
ÄÄ# 1
{
ÅÅ 
ParameterName
ÇÇ 
=
ÇÇ 
$str
ÇÇ  +
,
ÇÇ+ ,
DbType
ÉÉ 
=
ÉÉ 
DbType
ÉÉ 
.
ÉÉ  
String
ÉÉ  &
,
ÉÉ& '
Value
ÑÑ 
=
ÑÑ 
password
ÑÑ  
,
ÑÑ  !
}
ÖÖ 
)
ÖÖ 
;
ÖÖ 
}
ÜÜ 	
private
àà 
void
àà 
BindUsername
àà !
(
àà! "
MySqlCommand
àà" .
cmd
àà/ 2
,
àà2 3
string
àà4 :
username
àà; C
)
ààC D
{
ââ 	
cmd
ää 
.
ää 

Parameters
ää 
.
ää 
Add
ää 
(
ää 
new
ää "
MySqlParameter
ää# 1
{
ãã 
ParameterName
åå 
=
åå 
$str
åå  +
,
åå+ ,
DbType
çç 
=
çç 
DbType
çç 
.
çç  
String
çç  &
,
çç& '
Value
éé 
=
éé 
username
éé  
,
éé  !
}
èè 
)
èè 
;
èè 
}
êê 	
private
íí 
void
íí 
BindPassword
íí !
(
íí! "
MySqlCommand
íí" .
cmd
íí/ 2
,
íí2 3
string
íí4 :
password
íí; C
)
ííC D
{
ìì 	
cmd
îî 
.
îî 

Parameters
îî 
.
îî 
Add
îî 
(
îî 
new
îî "
MySqlParameter
îî# 1
{
ïï 
ParameterName
ññ 
=
ññ 
$str
ññ  +
,
ññ+ ,
DbType
óó 
=
óó 
DbType
óó 
.
óó  
String
óó  &
,
óó& '
Value
òò 
=
òò 
password
òò  
,
òò  !
}
ôô 
)
ôô 
;
ôô 
}
öö 	
}
õõ 
}úú §
7D:\School\GameOfLifeAPIs\UserAPI\UserAPI\Models\User.cs
	namespace 	
UserAPI
 
. 
Models 
{ 
public 

class 
User 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 
string		 
Password		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
public 
User 
( 
) 
{ 	
} 	
} 
} 

3D:\School\GameOfLifeAPIs\UserAPI\UserAPI\Program.cs
	namespace 	
UserAPI
 
{ 
public 

class 
Program 
{ 
	protected 
Program 
( 
) 
{		 	
} 	
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} ˜
3D:\School\GameOfLifeAPIs\UserAPI\UserAPI\Startup.cs
	namespace		 	
UserAPI		
 
{

 
public 

class 
Startup 
{ 
readonly 
string "
MyAllowSpecificOrigins .
=/ 0
$str1 J
;J K
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
AddCors 
( 
options $
=>% '
{ 
options 
. 
	AddPolicy !
(! "
name" &
:& '"
MyAllowSpecificOrigins( >
,> ?
builder" )
=>* ,
{" #
builder& -
.- .
WithOrigins. 9
(9 :
$str: Q
)Q R
;R S
}" #
)# $
;$ %
}   
)   
;   
services"" 
."" 
AddControllers"" #
(""# $
)""$ %
;""% &
services## 
.## 
AddTransient## !
<##! "

IUserQuery##" ,
,##, -
	UserQuery##. 7
>##7 8
(##8 9
_##9 :
=>##; =
new##> A
	UserQuery##B K
(##K L
Configuration##L Y
[##Y Z
$str##Z 
]	## Ä
)
##Ä Å
)
##Å Ç
;
##Ç É
}$$ 	
public'' 
void'' 
	Configure'' 
('' 
IApplicationBuilder'' 1
app''2 5
,''5 6
IWebHostEnvironment''7 J
env''K N
)''N O
{(( 	
if)) 
()) 
env)) 
.)) 
IsDevelopment)) !
())! "
)))" #
)))# $
{** 
app++ 
.++ %
UseDeveloperExceptionPage++ -
(++- .
)++. /
;++/ 0
},, 
app.. 
... 
UseHttpsRedirection.. #
(..# $
)..$ %
;..% &
app00 
.00 

UseRouting00 
(00 
)00 
;00 
app22 
.22 
UseCors22 
(22 "
MyAllowSpecificOrigins22 .
)22. /
;22/ 0
app44 
.44 
UseAuthorization44  
(44  !
)44! "
;44" #
app66 
.66 
UseEndpoints66 
(66 
	endpoints66 &
=>66' )
{77 
	endpoints88 
.88 
MapControllers88 (
(88( )
)88) *
;88* +
}99 
)99 
;99 
}:: 	
};; 
}<< 